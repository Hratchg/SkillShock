<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SkillShock — Career Intelligence</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
:root{
  --bg:        #0b0b0b;
  --bg2:       #111111;
  --surface:   #161616;
  --surface2:  #1c1c1c;
  --border:    #242424;
  --border2:   #303030;
  --text1:     #f4f4f4;
  --text2:     #8a8a8a;
  --text3:     #484848;
  --gold:      #c9a96e;
  --gold2:     #e8c98a;
  --gold-dim:  #6b5535;
  --glow:      rgba(201,169,110,0.15);
  --r:         12px;
  --rsm:       8px;
}
body{
  background:var(--bg);color:var(--text1);
  font-family:'Inter',sans-serif;
  -webkit-font-smoothing:antialiased;
  min-height:100vh;
  overflow-x:hidden;
}

/* ── Loader ── */
#loader{
  position:fixed;inset:0;background:var(--bg);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:9999;transition:opacity .6s ease;
}
#loader.fade{opacity:0;pointer-events:none;}
.l-hex{animation:lbreathe 2s ease-in-out infinite;}
@keyframes lbreathe{
  0%,100%{transform:scale(1) rotate(0deg);filter:drop-shadow(0 0 16px rgba(201,169,110,.5));}
  50%{transform:scale(.88) rotate(3deg);filter:drop-shadow(0 0 32px rgba(201,169,110,.8));}
}
.l-name{
  margin-top:20px;font-size:22px;font-weight:600;letter-spacing:-.02em;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.l-tag{
  margin-top:6px;font-size:11px;font-weight:500;letter-spacing:.2em;
  text-transform:uppercase;color:var(--text3);
}
.l-tag::after{content:'';animation:ldots 1.6s steps(4,end) infinite;}
@keyframes ldots{0%{content:''}25%{content:'.'}50%{content:'..'}75%{content:'...'}}

/* ── Hero header ── */
.hero{
  position:relative;overflow:hidden;
  padding:0 72px;
  min-height:160px;
  background:var(--bg);
  border-bottom:1px solid var(--border);
}
.hero::before{
  content:'';position:absolute;
  top:-120px;left:-80px;
  width:600px;height:600px;
  background:radial-gradient(circle,rgba(201,169,110,.07) 0%,transparent 65%);
  pointer-events:none;
}
.hero::after{
  content:'';position:absolute;
  bottom:-60px;right:10%;
  width:400px;height:400px;
  background:radial-gradient(circle,rgba(201,169,110,.04) 0%,transparent 65%);
  pointer-events:none;
}
.hero-inner{
  display:flex;align-items:center;justify-content:space-between;
  padding:48px 0 44px;
  gap:40px;
  position:relative;z-index:1;
}
.hero-left{display:flex;align-items:center;gap:24px;}
.hero-logo-wrap{
  position:relative;flex-shrink:0;
}
.hero-logo-glow{
  position:absolute;inset:-12px;
  background:radial-gradient(circle,rgba(201,169,110,.18) 0%,transparent 65%);
  border-radius:50%;
  animation:glowpulse 3s ease-in-out infinite;
}
@keyframes glowpulse{
  0%,100%{opacity:.6;transform:scale(1);}
  50%{opacity:1;transform:scale(1.1);}
}
.hero-text{}
.hero-name{
  font-size:36px;font-weight:700;letter-spacing:-.03em;line-height:1;
  background:linear-gradient(135deg,var(--text1) 0%,var(--gold2) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.hero-sub{
  margin-top:8px;font-size:12px;font-weight:500;letter-spacing:.16em;
  text-transform:uppercase;color:var(--text3);
}
.hero-right{
  display:flex;flex-direction:column;align-items:flex-end;gap:16px;
}
.hero-pills{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;}
.hero-pill{
  font-size:11px;font-weight:500;letter-spacing:.06em;
  padding:6px 14px;border-radius:999px;
  border:1px solid var(--border2);
  color:var(--text2);background:var(--surface);
  white-space:nowrap;
}
.hero-pill.accent{
  color:var(--gold);
  border-color:rgba(201,169,110,.35);
  background:rgba(201,169,110,.08);
}
.hero-dateline{font-size:11px;color:var(--text3);}

/* ── Stat strip inside hero ── */
.stat-strip{
  display:flex;
  border-top:1px solid var(--border);
  margin:0 -72px;padding:0 72px;
  background:var(--bg2);
  position:relative;z-index:1;
}
.stat-item{
  flex:1;padding:32px 36px;
  border-right:1px solid var(--border);
  transition:background .2s;
  cursor:default;
}
.stat-item:last-child{border-right:none;}
.stat-item:hover{background:rgba(201,169,110,.03);}
.stat-n{
  font-size:26px;font-weight:600;letter-spacing:-.03em;
  color:var(--text1);line-height:1;margin-bottom:8px;
}
.stat-l{
  font-size:10px;font-weight:500;letter-spacing:.12em;
  text-transform:uppercase;color:var(--text3);
}

/* ── Nav / tabbar (sticky below hero) ── */
.tabbar{
  position:sticky;top:0;z-index:100;
  display:flex;align-items:stretch;
  background:rgba(11,11,11,.94);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(16px);
  -webkit-backdrop-filter:blur(16px);
  padding:0 72px;
  overflow-x:auto;
}
.tabbar::-webkit-scrollbar{display:none;}
.tab-btn{
  flex-shrink:0;height:48px;
  padding:0 4px;margin-right:32px;
  font-size:13px;font-weight:400;color:var(--text3);
  background:none;border:none;
  border-bottom:1.5px solid transparent;
  cursor:pointer;
  transition:color .2s,border-color .2s;
  white-space:nowrap;
}
.tab-btn:hover{color:var(--text2);}
.tab-btn.active{color:var(--text1);border-bottom-color:var(--gold);font-weight:500;}

/* ── Panels ── */
.panel{display:none;animation:fadein .3s ease both;}
.panel.active{display:block;}
@keyframes fadein{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}

/* ── Overview panel ── */
.ov-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:1px;
  background:var(--border);
  border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);
}
.ov-card{
  background:var(--bg);
  padding:52px 60px;
  position:relative;overflow:hidden;
  transition:background .25s;
}
.ov-card:hover{background:var(--bg2);}
.ov-card-label{
  font-size:10px;font-weight:500;letter-spacing:.16em;text-transform:uppercase;
  color:var(--text3);margin-bottom:20px;
}
.ov-card-title{
  font-size:22px;font-weight:600;letter-spacing:-.02em;
  color:var(--text1);margin-bottom:12px;line-height:1.2;
}
.ov-card-desc{
  font-size:13px;color:var(--text2);line-height:1.7;max-width:480px;
}
.ov-card-nums{
  display:flex;gap:48px;margin-top:36px;
}
.ov-num{
  display:flex;flex-direction:column;gap:6px;
}
.ov-num-val{
  font-size:34px;font-weight:700;letter-spacing:-.04em;color:var(--text1);line-height:1;
}
.ov-num-lbl{font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--text3);}
.ov-card-accent{
  position:absolute;top:0;left:0;right:0;height:1.5px;
  background:linear-gradient(90deg,var(--gold),transparent);
  opacity:0;transition:opacity .25s;
}
.ov-card:hover .ov-card-accent{opacity:1;}

/* ── Section header ── */
.sec-head{
  display:flex;align-items:flex-end;justify-content:space-between;
  padding:52px 72px 0;
  margin-bottom:36px;
}
.sec-head-left{}
.sec-eyebrow{
  font-size:10px;font-weight:500;letter-spacing:.18em;text-transform:uppercase;
  color:var(--gold);margin-bottom:10px;
}
.sec-title{
  font-size:30px;font-weight:700;letter-spacing:-.025em;
  color:var(--text1);line-height:1.1;
}
.sec-desc{
  font-size:13px;color:var(--text2);line-height:1.6;
  max-width:500px;margin-top:10px;
}

/* ── Controls ── */
.controls{
  display:flex;gap:14px;align-items:flex-end;
  padding:0 72px 32px;
}
.field{display:flex;flex-direction:column;gap:7px;}
.field label{
  font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;
  color:var(--text3);
}
.field input,.field select{
  background:var(--surface);
  border:1px solid var(--border2);
  border-radius:var(--rsm);
  color:var(--text1);font-family:inherit;font-size:13px;
  padding:10px 14px;outline:none;
  transition:border-color .18s,box-shadow .18s;
  min-width:200px;
  -webkit-appearance:none;appearance:none;
}
.field input:focus,.field select:focus{
  border-color:var(--gold);
  box-shadow:0 0 0 3px rgba(201,169,110,.1);
}
.field select{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23484848' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 12px center;
  padding-right:36px;cursor:pointer;
}
.field select option{background:#1c1c1c;}
.field.wide{flex:1;}
.field.wide select,.field.wide input{width:100%;}

/* ── Chart panel ── */
.chart-panel{
  margin:0 72px 64px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r);
  overflow:hidden;
  position:relative;
}
.chart-panel::before{
  content:'';position:absolute;
  top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,var(--gold),transparent 60%);
  opacity:.4;
}
.chart-inner{width:100%;min-height:420px;}
.chart-loading{
  display:flex;align-items:center;justify-content:center;
  min-height:420px;
  flex-direction:column;gap:14px;
  color:var(--text3);font-size:11px;letter-spacing:.12em;text-transform:uppercase;
}
.chart-loading-hex{
  width:32px;height:32px;
  animation:lbreathe 1.8s ease-in-out infinite;
  opacity:.4;
}

/* ── Paths panel ── */
.paths-panel{
  margin:0 72px 64px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r);
  overflow:hidden;
  position:relative;
}
.paths-panel::before{
  content:'';position:absolute;
  top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,var(--gold),transparent 60%);
  opacity:.4;
}
.paths-header{
  display:flex;align-items:center;
  padding:20px 32px 18px;
  border-bottom:1px solid var(--border);
  background:var(--surface2);
}
.paths-header span{
  font-size:10px;font-weight:500;letter-spacing:.14em;text-transform:uppercase;color:var(--text3);
}
.paths-header .ph-r{margin-left:auto;}
.path-row{
  display:flex;align-items:center;gap:20px;
  padding:26px 32px;
  border-bottom:1px solid var(--border);
  transition:background .18s;cursor:default;
}
.path-row:hover{background:rgba(201,169,110,.03);}
.path-row:last-child{border-bottom:none;}
.path-idx{
  width:28px;height:28px;border-radius:50%;
  background:rgba(201,169,110,.08);border:1px solid rgba(201,169,110,.2);
  display:flex;align-items:center;justify-content:center;
  font-size:11px;font-weight:600;color:var(--gold);flex-shrink:0;
}
.path-chips{display:flex;align-items:center;flex-wrap:wrap;gap:6px;flex:1;}
.chip{
  background:rgba(255,255,255,.05);
  border:1px solid var(--border2);
  border-radius:6px;padding:6px 14px;
  font-size:13px;color:var(--text1);white-space:nowrap;
  transition:border-color .18s,background .18s;
}
.path-row:hover .chip{border-color:rgba(201,169,110,.2);background:rgba(201,169,110,.04);}
.chip-arr{color:var(--text3);font-size:13px;margin:0 2px;}
.path-vol{
  font-size:12px;font-weight:500;color:var(--gold);
  flex-shrink:0;min-width:80px;text-align:right;
  font-variant-numeric:tabular-nums;
}

/* ── Scrollbar ── */
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
::-webkit-scrollbar-thumb:hover{background:var(--gold-dim);}
</style>
</head>
<body>

<!-- ── Loader ── -->
<div id="loader">
  <svg class="l-hex" width="72" height="72" viewBox="0 0 40 40" fill="none">
    <defs>
      <linearGradient id="ll" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
        <stop offset="0%" stop-color="#c9a96e"/>
        <stop offset="100%" stop-color="#e8c98a"/>
      </linearGradient>
      <filter id="lf"><feGaussianBlur stdDeviation="1.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    </defs>
    <path d="M20 3 L35 11.5 L35 28.5 L20 37 L5 28.5 L5 11.5 Z" stroke="url(#ll)" stroke-width="1.6" fill="url(#ll)" fill-opacity="0.1" filter="url(#lf)"/>
    <path d="M20 3 L35 11.5 L35 20 L20 20 L5 20 L5 11.5 Z" fill="url(#ll)" opacity="0.2"/>
    <line x1="5" y1="20" x2="35" y2="20" stroke="url(#ll)" stroke-width="1.6"/>
    <line x1="20" y1="3" x2="5" y2="20" stroke="url(#ll)" stroke-width="1.6" opacity="0.55"/>
    <line x1="20" y1="37" x2="35" y2="20" stroke="url(#ll)" stroke-width="1.6" opacity="0.55"/>
  </svg>
  <div class="l-name">SkillShock</div>
  <div class="l-tag">Loading</div>
</div>

<!-- ── Hero Header ── -->
<header class="hero">
  <div class="hero-inner">
    <div class="hero-left">
      <div class="hero-logo-wrap">
        <div class="hero-logo-glow"></div>
        <svg width="72" height="72" viewBox="0 0 40 40" fill="none">
          <defs>
            <linearGradient id="hl" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
              <stop offset="0%" stop-color="#c9a96e"/>
              <stop offset="100%" stop-color="#e8c98a"/>
            </linearGradient>
            <filter id="hf" x="-40%" y="-40%" width="180%" height="180%">
              <feGaussianBlur stdDeviation="2" result="b"/>
              <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <path d="M20 3 L35 11.5 L35 28.5 L20 37 L5 28.5 L5 11.5 Z" stroke="url(#hl)" stroke-width="1.6" fill="url(#hl)" fill-opacity="0.1" filter="url(#hf)"/>
          <path d="M20 3 L35 11.5 L35 20 L20 20 L5 20 L5 11.5 Z" fill="url(#hl)" opacity="0.22"/>
          <line x1="5" y1="20" x2="35" y2="20" stroke="url(#hl)" stroke-width="1.6"/>
          <line x1="20" y1="3" x2="5" y2="20" stroke="url(#hl)" stroke-width="1.6" opacity="0.55"/>
          <line x1="20" y1="37" x2="35" y2="20" stroke="url(#hl)" stroke-width="1.6" opacity="0.55"/>
        </svg>
      </div>
      <div class="hero-text">
        <div class="hero-name">SkillShock</div>
        <div class="hero-sub">Career Intelligence Platform</div>
      </div>
    </div>
    <div class="hero-right">
      <div class="hero-pills">
        <span class="hero-pill accent" id="pill-persons">— profiles</span>
        <span class="hero-pill" id="pill-date">—</span>
        <span class="hero-pill accent">Live Data Technologies</span>
      </div>
    </div>
  </div>
  <!-- Stat strip -->
  <div class="stat-strip" id="stat-strip">
    <!-- filled by JS -->
  </div>
</header>

<!-- ── Tab Bar ── -->
<div class="tabbar">
  <button class="tab-btn active" data-tab="overview">Overview</button>
  <button class="tab-btn" data-tab="promo">Promotion Velocity</button>
  <button class="tab-btn" data-tab="roles">Role Transitions</button>
  <button class="tab-btn" data-tab="major">Major → First Role</button>
  <button class="tab-btn" data-tab="industry">Industry Transitions</button>
  <button class="tab-btn" data-tab="paths">Career Paths</button>
</div>

<!-- ── Overview ── -->
<div class="panel active" id="tab-overview">
  <div class="ov-grid" id="ov-grid">
    <!-- filled by JS -->
  </div>
</div>

<!-- ── Promotion Velocity ── -->
<div class="panel" id="tab-promo">
  <div class="sec-head">
    <div class="sec-head-left">
      <div class="sec-eyebrow">Insight · Promotion Velocity</div>
      <div class="sec-title">How fast do careers advance?</div>
      <div class="sec-desc">Median months between career level transitions. Gold bars are high-confidence estimates; muted bars have small sample sizes.</div>
    </div>
  </div>
  <div class="chart-panel">
    <div class="chart-inner chart-loading" id="chart-promo">
      <svg class="chart-loading-hex" viewBox="0 0 40 40" fill="none">
        <path d="M20 3 L35 11.5 L35 28.5 L20 37 L5 28.5 L5 11.5 Z" stroke="#c9a96e" stroke-width="1.6" fill="none"/>
        <line x1="5" y1="20" x2="35" y2="20" stroke="#c9a96e" stroke-width="1.6" opacity=".5"/>
      </svg>
      Loading
    </div>
  </div>
</div>

<!-- ── Role Transitions ── -->
<div class="panel" id="tab-roles">
  <div class="sec-head">
    <div class="sec-head-left">
      <div class="sec-eyebrow">Explorer · Role Transitions</div>
      <div class="sec-title">Where do people go next?</div>
      <div class="sec-desc">Select a source role to see the ten most likely positions professionals moved into after it.</div>
    </div>
  </div>
  <div class="controls">
    <div class="field">
      <label>Search Roles</label>
      <input type="text" id="role-search" placeholder="e.g. Software Engineer…"/>
    </div>
    <div class="field wide">
      <label>Source Role</label>
      <select id="role-select"></select>
    </div>
  </div>
  <div class="chart-panel">
    <div class="chart-inner chart-loading" id="chart-role">
      <svg class="chart-loading-hex" viewBox="0 0 40 40" fill="none">
        <path d="M20 3 L35 11.5 L35 28.5 L20 37 L5 28.5 L5 11.5 Z" stroke="#c9a96e" stroke-width="1.6" fill="none"/>
        <line x1="5" y1="20" x2="35" y2="20" stroke="#c9a96e" stroke-width="1.6" opacity=".5"/>
      </svg>
      Loading
    </div>
  </div>
</div>

<!-- ── Major → First Role ── -->
<div class="panel" id="tab-major">
  <div class="sec-head">
    <div class="sec-head-left">
      <div class="sec-eyebrow">Explorer · Major to First Role</div>
      <div class="sec-title">Where does your degree take you?</div>
      <div class="sec-desc">The most common first job titles for graduates of a given field of study, ranked by probability.</div>
    </div>
  </div>
  <div class="controls">
    <div class="field">
      <label>Search Majors</label>
      <input type="text" id="major-search" placeholder="e.g. Computer Science…"/>
    </div>
    <div class="field wide">
      <label>Major / Field of Study</label>
      <select id="major-select"></select>
    </div>
  </div>
  <div class="chart-panel">
    <div class="chart-inner chart-loading" id="chart-major">
      <svg class="chart-loading-hex" viewBox="0 0 40 40" fill="none">
        <path d="M20 3 L35 11.5 L35 28.5 L20 37 L5 28.5 L5 11.5 Z" stroke="#c9a96e" stroke-width="1.6" fill="none"/>
        <line x1="5" y1="20" x2="35" y2="20" stroke="#c9a96e" stroke-width="1.6" opacity=".5"/>
      </svg>
      Loading
    </div>
  </div>
</div>

<!-- ── Industry Transitions ── -->
<div class="panel" id="tab-industry">
  <div class="sec-head">
    <div class="sec-head-left">
      <div class="sec-eyebrow">Explorer · Industry Transitions</div>
      <div class="sec-title">Which industries do people move to?</div>
      <div class="sec-desc">Probability distribution of destination industries for professionals leaving a given sector.</div>
    </div>
  </div>
  <div class="controls">
    <div class="field">
      <label>Search Industries</label>
      <input type="text" id="ind-search" placeholder="e.g. Technology…"/>
    </div>
    <div class="field wide">
      <label>Source Industry</label>
      <select id="ind-select"></select>
    </div>
  </div>
  <div class="chart-panel">
    <div class="chart-inner chart-loading" id="chart-ind">
      <svg class="chart-loading-hex" viewBox="0 0 40 40" fill="none">
        <path d="M20 3 L35 11.5 L35 28.5 L20 37 L5 28.5 L5 11.5 Z" stroke="#c9a96e" stroke-width="1.6" fill="none"/>
        <line x1="5" y1="20" x2="35" y2="20" stroke="#c9a96e" stroke-width="1.6" opacity=".5"/>
      </svg>
      Loading
    </div>
  </div>
</div>

<!-- ── Career Paths ── -->
<div class="panel" id="tab-paths">
  <div class="sec-head">
    <div class="sec-head-left">
      <div class="sec-eyebrow">Explorer · Career Paths</div>
      <div class="sec-title">What roads lead here?</div>
      <div class="sec-desc">The five most common sequences of roles that professionals followed to reach a chosen target position.</div>
    </div>
  </div>
  <div class="controls">
    <div class="field">
      <label>Search Roles</label>
      <input type="text" id="path-search" placeholder="e.g. Director…"/>
    </div>
    <div class="field wide">
      <label>Target Role</label>
      <select id="path-select"></select>
    </div>
  </div>
  <div class="paths-panel">
    <div class="paths-header">
      <span>Career Path</span>
      <span class="ph-r">People</span>
    </div>
    <div id="paths-list"></div>
  </div>
</div>

<script>
/* ── Plotly shared ── */
const BG     = '#161616';
const GOLD   = '#c9a96e';
const GOLDDIM= '#3a3020';
const TEXT1  = '#f4f4f4';
const TEXT2  = '#8a8a8a';
const TEXT3  = '#484848';
const GRID   = '#1e1e1e';

const BASE_LAYOUT = {
  paper_bgcolor: BG,
  plot_bgcolor:  BG,
  font: { family:"'Inter',sans-serif", color:TEXT2, size:12 },
  margin: { l:8, r:110, t:32, b:44 },
  xaxis: {
    gridcolor:GRID, zeroline:false, color:TEXT3,
    tickfont:{size:11}, linecolor:GRID,
  },
  yaxis: {
    gridcolor:'rgba(0,0,0,0)', zeroline:false,
    color:TEXT1, tickfont:{size:13}, showgrid:false,
    automargin:true,
  },
  showlegend:false,
  bargap:0.38,
};
const CFG = { displayModeBar:false, responsive:true };

function plotBar(id, x, y, colors, texts, extra={}) {
  const el = document.getElementById(id);
  el.classList.remove('chart-loading');
  el.innerHTML = '';
  Plotly.newPlot(el,
    [{ type:'bar', orientation:'h', x, y,
       marker:{ color:colors, line:{width:0} },
       text:texts, textposition:'outside',
       textfont:{size:12, color:'#686868'},
       cliponaxis:false,
       insidetextanchor:'start' }],
    Object.assign({}, BASE_LAYOUT, {height:500}, extra),
    CFG);
}

/* ── Animated counter ── */
function animateCount(el, target) {
  const str = target.replace(/,/g,'');
  const num = parseInt(str, 10);
  if (isNaN(num)) { el.textContent = target; return; }
  let start = 0;
  const dur = 900, step = 16;
  const steps = Math.ceil(dur/step);
  let i = 0;
  const t = setInterval(() => {
    i++;
    const progress = i/steps;
    const ease = 1 - Math.pow(1 - progress, 3);
    const cur = Math.round(ease * num);
    el.textContent = cur.toLocaleString();
    if (i >= steps) { el.textContent = target; clearInterval(t); }
  }, step);
}

/* ── Filter helper ── */
function filterSelect(sel, all, q) {
  q = q.trim().toLowerCase();
  const filt = q
    ? [...all.filter(o=>o.toLowerCase().startsWith(q)),
       ...all.filter(o=>!o.toLowerCase().startsWith(q)&&o.toLowerCase().includes(q))]
    : all;
  const prev = sel.value;
  sel.innerHTML = filt.map(o=>`<option value="${o.replace(/"/g,'&quot;')}">${o}</option>`).join('');
  if (filt.includes(prev)) sel.value = prev;
  return sel.value;
}

let META = null;

/* ── Boot ── */
async function boot() {
  META = await fetch('/api/meta').then(r=>r.json());

  /* Pills */
  document.getElementById('pill-persons').textContent =
    META.stats.total_persons.toLocaleString() + ' profiles';
  document.getElementById('pill-date').textContent =
    'Updated ' + META.metadata.generated_at.slice(0,10);

  /* Stat strip */
  const strips = [
    [META.stats.total_persons, 'Persons Analyzed'],
    [META.stats.total_jobs,    'Job Records'],
    [META.stats.unique_roles,  'Unique Roles'],
    [META.stats.majors,        'Fields of Study'],
    [META.stats.industries,    'Industries'],
    [META.stats.target_roles,  'Career Paths Mapped'],
  ];
  const stripEl = document.getElementById('stat-strip');
  stripEl.innerHTML = strips.map(([n,l])=>`
    <div class="stat-item">
      <div class="stat-n" data-target="${n.toLocaleString()}">0</div>
      <div class="stat-l">${l}</div>
    </div>`).join('');
  // Animate after tiny delay
  setTimeout(()=>{
    stripEl.querySelectorAll('.stat-n').forEach(el=>{
      animateCount(el, el.dataset.target);
    });
  }, 200);

  /* Overview grid */
  const files = META.metadata.data_files.join(' · ') || '—';
  document.getElementById('ov-grid').innerHTML = `
    <div class="ov-card">
      <div class="ov-card-accent"></div>
      <div class="ov-card-label">Dataset Scale</div>
      <div class="ov-card-title">Built on ${META.stats.total_persons.toLocaleString()} real career journeys</div>
      <div class="ov-card-desc">Sourced from Live Data Technologies, this dataset captures millions of individual role transitions, promotions, and career pivots across industries and geographies.</div>
      <div class="ov-card-nums">
        <div class="ov-num">
          <div class="ov-num-val">${META.stats.total_persons.toLocaleString()}</div>
          <div class="ov-num-lbl">Profiles</div>
        </div>
        <div class="ov-num">
          <div class="ov-num-val">${META.stats.total_jobs.toLocaleString()}</div>
          <div class="ov-num-lbl">Job Records</div>
        </div>
      </div>
    </div>
    <div class="ov-card">
      <div class="ov-card-accent"></div>
      <div class="ov-card-label">Role Intelligence</div>
      <div class="ov-card-title">${META.stats.unique_roles.toLocaleString()} roles mapped across the career graph</div>
      <div class="ov-card-desc">Every transition between job titles is weighted by probability. Explore where any role tends to go next, and how long each move typically takes.</div>
      <div class="ov-card-nums">
        <div class="ov-num">
          <div class="ov-num-val">${META.stats.unique_roles.toLocaleString()}</div>
          <div class="ov-num-lbl">Unique Roles</div>
        </div>
        <div class="ov-num">
          <div class="ov-num-val">${META.stats.target_roles.toLocaleString()}</div>
          <div class="ov-num-lbl">Career Paths</div>
        </div>
      </div>
    </div>
    <div class="ov-card">
      <div class="ov-card-accent"></div>
      <div class="ov-card-label">Education Outcomes</div>
      <div class="ov-card-title">What ${META.stats.majors.toLocaleString()} majors actually lead to</div>
      <div class="ov-card-desc">From Computer Science to Philosophy — see exactly which job titles new graduates land in and the probability distribution of those first career steps.</div>
      <div class="ov-card-nums">
        <div class="ov-num">
          <div class="ov-num-val">${META.stats.majors.toLocaleString()}</div>
          <div class="ov-num-lbl">Fields of Study</div>
        </div>
      </div>
    </div>
    <div class="ov-card">
      <div class="ov-card-accent"></div>
      <div class="ov-card-label">Industry Mobility</div>
      <div class="ov-card-title">Cross-sector movement across ${META.stats.industries.toLocaleString()} industries</div>
      <div class="ov-card-desc">Understand how professionals migrate between sectors — which industries retain talent and which act as stepping stones to others. Source: ${files}.</div>
      <div class="ov-card-nums">
        <div class="ov-num">
          <div class="ov-num-val">${META.stats.industries.toLocaleString()}</div>
          <div class="ov-num-lbl">Industries</div>
        </div>
      </div>
    </div>`;

  /* Populate selects */
  ['role-select','major-select','ind-select','path-select'].forEach((id,i)=>{
    const lists=[META.top_roles,META.top_majors,META.top_industries,META.top_target_roles];
    const sel=document.getElementById(id);
    sel.innerHTML=lists[i].map(o=>`<option value="${o.replace(/"/g,'&quot;')}">${o}</option>`).join('');
  });

  /* Hide loader */
  const ldr=document.getElementById('loader');
  ldr.classList.add('fade');
  setTimeout(()=>ldr.remove(),700);

  /* Pre-load all charts */
  loadPromo();
  loadRole(META.top_roles[0]);
  loadMajor(META.top_majors[0]);
  loadInd(META.top_industries[0]);
  loadPaths(META.top_target_roles[0]);
}

/* ── Loaders ── */
function setLoading(id) {
  const el=document.getElementById(id);
  el.innerHTML=`
    <svg class="chart-loading-hex" viewBox="0 0 40 40" fill="none">
      <path d="M20 3 L35 11.5 L35 28.5 L20 37 L5 28.5 L5 11.5 Z" stroke="#c9a96e" stroke-width="1.6" fill="none"/>
      <line x1="5" y1="20" x2="35" y2="20" stroke="#c9a96e" stroke-width="1.6" opacity=".5"/>
    </svg>Loading`;
  el.classList.add('chart-loading');
}

async function loadPromo() {
  const data=await fetch('/api/promo').then(r=>r.json());
  const ents=Object.entries(data).sort((a,b)=>a[1].median_months-b[1].median_months);
  const el=document.getElementById('chart-promo');
  el.classList.remove('chart-loading');el.innerHTML='';
  Plotly.newPlot(el,[
    { type:'bar',orientation:'h',
      x:ents.filter(e=>!e[1].low_confidence).map(e=>e[1].median_months),
      y:ents.filter(e=>!e[1].low_confidence).map(e=>e[0]),
      marker:{color:GOLD,line:{width:0}},
      text:ents.filter(e=>!e[1].low_confidence).map(e=>`${e[1].median_months.toFixed(0)} mo`),
      textposition:'outside',textfont:{size:11,color:TEXT3},
      name:'High confidence',cliponaxis:false },
    { type:'bar',orientation:'h',
      x:ents.filter(e=>e[1].low_confidence).map(e=>e[1].median_months),
      y:ents.filter(e=>e[1].low_confidence).map(e=>e[0]),
      marker:{color:GOLDDIM,line:{width:0}},
      text:ents.filter(e=>e[1].low_confidence).map(e=>`${e[1].median_months.toFixed(0)} mo`),
      textposition:'outside',textfont:{size:11,color:TEXT3},
      name:'Low confidence',cliponaxis:false },
  ],Object.assign({},BASE_LAYOUT,{
    height:540,showlegend:true,
    legend:{bgcolor:'rgba(0,0,0,0)',font:{color:TEXT2,size:11},orientation:'h',x:0,y:1.04},
    xaxis:{...BASE_LAYOUT.xaxis,title:{text:'Median months',font:{size:11,color:TEXT3}}},
  }),CFG);
}

async function loadRole(role) {
  if(!role)return;setLoading('chart-role');
  const data=await fetch(`/api/role/${encodeURIComponent(role)}`).then(r=>r.json());
  const p=data.transitions.slice().reverse();
  plotBar('chart-role',p.map(x=>x[1]),p.map(x=>x[0]),p.map(()=>GOLD),
    p.map(x=>`${(x[1]*100).toFixed(1)}%`),
    {xaxis:{...BASE_LAYOUT.xaxis,tickformat:'.0%',title:{text:'Probability',font:{size:11,color:TEXT3}}},height:500,showlegend:false});
}

async function loadMajor(major) {
  if(!major)return;setLoading('chart-major');
  const data=await fetch(`/api/major/${encodeURIComponent(major)}`).then(r=>r.json());
  const p=data.roles.slice().reverse();
  plotBar('chart-major',p.map(x=>x[1]),p.map(x=>x[0]),p.map(()=>GOLD),
    p.map(x=>`${(x[1]*100).toFixed(1)}%`),
    {xaxis:{...BASE_LAYOUT.xaxis,tickformat:'.0%',title:{text:'Probability',font:{size:11,color:TEXT3}}},height:500,showlegend:false});
}

async function loadInd(ind) {
  if(!ind)return;setLoading('chart-ind');
  const data=await fetch(`/api/industry/${encodeURIComponent(ind)}`).then(r=>r.json());
  const p=data.destinations.slice().reverse();
  plotBar('chart-ind',p.map(x=>x[1]),p.map(x=>x[0]),p.map(()=>GOLD),
    p.map(x=>`${(x[1]*100).toFixed(1)}%`),
    {xaxis:{...BASE_LAYOUT.xaxis,tickformat:'.0%',title:{text:'Probability',font:{size:11,color:TEXT3}}},height:500,showlegend:false});
}

async function loadPaths(role) {
  if(!role)return;
  const data=await fetch(`/api/paths/${encodeURIComponent(role)}`).then(r=>r.json());
  const list=document.getElementById('paths-list');
  if(!data.paths.length){
    list.innerHTML=`<div style="padding:40px 28px;color:${TEXT3};font-size:13px;">No data for this role.</div>`;
    return;
  }
  list.innerHTML=data.paths.map((entry,i)=>{
    // Deduplicate consecutive identical steps
    const deduped=[];
    let count=1;
    for(let j=0;j<entry.path.length;j++){
      if(j>0 && entry.path[j]===entry.path[j-1]){
        count++;
        deduped[deduped.length-1].count=count;
      } else {
        count=1;
        deduped.push({step:entry.path[j],count:1});
      }
    }
    const chips=deduped.map((d,j)=>{
      const badge=d.count>1?` <span style="font-size:10px;color:var(--gold);opacity:.7;">x${d.count}</span>`:'';
      const arr=j<deduped.length-1?`<span class="chip-arr">&#8594;</span>`:'';
      return `<span class="chip">${d.step}${badge}</span>${arr}`;
    }).join('');
    return `
    <div class="path-row">
      <div class="path-idx">${i+1}</div>
      <div class="path-chips">${chips}</div>
      <div class="path-vol">${entry.frequency.toLocaleString()}</div>
    </div>`;
  }).join('');
}

/* ── Tabs ── */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('tab-'+btn.dataset.tab).classList.add('active');
    setTimeout(()=>window.dispatchEvent(new Event('resize')),60);
  });
});

/* ── Search wiring ── */
function wire(searchId,selectId,list,loader){
  const inp=document.getElementById(searchId);
  const sel=document.getElementById(selectId);
  inp.addEventListener('input',()=>{ const v=filterSelect(sel,list(),inp.value); if(v)loader(v); });
  sel.addEventListener('change',()=>loader(sel.value));
}

boot().then(()=>{
  wire('role-search','role-select',()=>META.top_roles,loadRole);
  wire('major-search','major-select',()=>META.top_majors,loadMajor);
  wire('ind-search','ind-select',()=>META.top_industries,loadInd);
  wire('path-search','path-select',()=>META.top_target_roles,loadPaths);
});
</script>
</body>
</html>
